<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.11.0"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>BMSNode: Shunt</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">BMSNode
							</div>
							<div id="projectbrief">BMS Node Cell Monitoring Firmware</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__shunt.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Shunt</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gabe10e4834cb594ddeea4baec47881ebc" id="r_gabe10e4834cb594ddeea4baec47881ebc"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gabe10e4834cb594ddeea4baec47881ebc">shunt_status</a> { <br />
&#160;&#160;<a class="el" href="#ggabe10e4834cb594ddeea4baec47881ebcaa0a58223036b0d29a15d21d4e0e304cd">SHUNT_OFF</a>
, <a class="el" href="#ggabe10e4834cb594ddeea4baec47881ebca4762f37a653dc3354b2acde646af4580">SHUNT_IDLE</a>
, <a class="el" href="#ggabe10e4834cb594ddeea4baec47881ebca6b3ddce3a3f3b50ae2345b387f519573">SHUNT_ON</a>
, <a class="el" href="#ggabe10e4834cb594ddeea4baec47881ebca30ec68bc96eff8ea70596a2250919c4d">SHUNT_NOTUSED</a>
, <br />
&#160;&#160;<a class="el" href="#ggabe10e4834cb594ddeea4baec47881ebca8482d9205599450d1695bbb039633fbf">SHUNT_LIMIT</a>
<br />
 }</td></tr>
<tr class="memdesc:gabe10e4834cb594ddeea4baec47881ebc"><td class="mdescLeft">&#160;</td><td class="mdescRight">shunt API return codes.  <a href="#gabe10e4834cb594ddeea4baec47881ebc">More...</a><br /></td></tr>
<tr class="separator:gabe10e4834cb594ddeea4baec47881ebc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaac05a672aeca49c7e39666437490c3a0" id="r_gaac05a672aeca49c7e39666437490c3a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaac05a672aeca49c7e39666437490c3a0">shunt_start</a> (void)</td></tr>
<tr class="memdesc:gaac05a672aeca49c7e39666437490c3a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start cell shunting mode.  <br /></td></tr>
<tr class="separator:gaac05a672aeca49c7e39666437490c3a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2df71fa1f27e94917cb24e2f958bd5e4" id="r_ga2df71fa1f27e94917cb24e2f958bd5e4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2df71fa1f27e94917cb24e2f958bd5e4">shunt_stop</a> (void)</td></tr>
<tr class="memdesc:ga2df71fa1f27e94917cb24e2f958bd5e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop cell shunting mode.  <br /></td></tr>
<tr class="separator:ga2df71fa1f27e94917cb24e2f958bd5e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab1f05b356328e9852ec84316041974db" id="r_gab1f05b356328e9852ec84316041974db"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="#gabe10e4834cb594ddeea4baec47881ebc">shunt_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab1f05b356328e9852ec84316041974db">shunt_get_status</a> (void)</td></tr>
<tr class="memdesc:gab1f05b356328e9852ec84316041974db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the shunt process status.  <br /></td></tr>
<tr class="separator:gab1f05b356328e9852ec84316041974db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga332dfcb3e6b5bb69971b64c11365dfef" id="r_ga332dfcb3e6b5bb69971b64c11365dfef"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga332dfcb3e6b5bb69971b64c11365dfef">shunt_get_pwm</a> (void)</td></tr>
<tr class="memdesc:ga332dfcb3e6b5bb69971b64c11365dfef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the PWM setting.  <br /></td></tr>
<tr class="separator:ga332dfcb3e6b5bb69971b64c11365dfef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafcfc1bc1d30f561b1c5e78965133abc1" id="r_gafcfc1bc1d30f561b1c5e78965133abc1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gafcfc1bc1d30f561b1c5e78965133abc1">shunt_set</a> (uint8_t newpwm)</td></tr>
<tr class="memdesc:gafcfc1bc1d30f561b1c5e78965133abc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the PWM level (out of 255).  <br /></td></tr>
<tr class="separator:gafcfc1bc1d30f561b1c5e78965133abc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4a8884dc58e141d827d1de7301d74636" id="r_ga4a8884dc58e141d827d1de7301d74636"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="#gabe10e4834cb594ddeea4baec47881ebc">shunt_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4a8884dc58e141d827d1de7301d74636">shunt_run</a> (void)</td></tr>
<tr class="memdesc:ga4a8884dc58e141d827d1de7301d74636"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run shunt mode monitoring process.  <br /></td></tr>
<tr class="separator:ga4a8884dc58e141d827d1de7301d74636"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="gabe10e4834cb594ddeea4baec47881ebc" name="gabe10e4834cb594ddeea4baec47881ebc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabe10e4834cb594ddeea4baec47881ebc">&#9670;&#160;</a></span>shunt_status</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#gabe10e4834cb594ddeea4baec47881ebc">shunt_status</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>shunt API return codes. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ggabe10e4834cb594ddeea4baec47881ebcaa0a58223036b0d29a15d21d4e0e304cd" name="ggabe10e4834cb594ddeea4baec47881ebcaa0a58223036b0d29a15d21d4e0e304cd"></a>SHUNT_OFF&#160;</td><td class="fielddoc"><p>shunt process is turned off </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabe10e4834cb594ddeea4baec47881ebca4762f37a653dc3354b2acde646af4580" name="ggabe10e4834cb594ddeea4baec47881ebca4762f37a653dc3354b2acde646af4580"></a>SHUNT_IDLE&#160;</td><td class="fielddoc"><p>enabled but not currently shunting </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabe10e4834cb594ddeea4baec47881ebca6b3ddce3a3f3b50ae2345b387f519573" name="ggabe10e4834cb594ddeea4baec47881ebca6b3ddce3a3f3b50ae2345b387f519573"></a>SHUNT_ON&#160;</td><td class="fielddoc"><p>active shunting </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabe10e4834cb594ddeea4baec47881ebca30ec68bc96eff8ea70596a2250919c4d" name="ggabe10e4834cb594ddeea4baec47881ebca30ec68bc96eff8ea70596a2250919c4d"></a>SHUNT_NOTUSED&#160;</td><td class="fielddoc"><p>unused (deprecated undervolt) </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabe10e4834cb594ddeea4baec47881ebca8482d9205599450d1695bbb039633fbf" name="ggabe10e4834cb594ddeea4baec47881ebca8482d9205599450d1695bbb039633fbf"></a>SHUNT_LIMIT&#160;</td><td class="fielddoc"><p>shunting limited by temperature </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaac05a672aeca49c7e39666437490c3a0" name="gaac05a672aeca49c7e39666437490c3a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaac05a672aeca49c7e39666437490c3a0">&#9670;&#160;</a></span>shunt_start()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shunt_start </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Start cell shunting mode. </p>
<p>The hardware will be configured and shunt process enabled. <a class="el" href="#ga4a8884dc58e141d827d1de7301d74636" title="Run shunt mode monitoring process.">shunt_run()</a> <b>must</b> be called periodically once shunting is turned on in order to run the monitoring process. </p>

</div>
</div>
<a id="ga2df71fa1f27e94917cb24e2f958bd5e4" name="ga2df71fa1f27e94917cb24e2f958bd5e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2df71fa1f27e94917cb24e2f958bd5e4">&#9670;&#160;</a></span>shunt_stop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shunt_stop </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stop cell shunting mode. </p>
<p>The shunt resistors are turned off and everything is safed. </p>

</div>
</div>
<a id="gab1f05b356328e9852ec84316041974db" name="gab1f05b356328e9852ec84316041974db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab1f05b356328e9852ec84316041974db">&#9670;&#160;</a></span>shunt_get_status()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#gabe10e4834cb594ddeea4baec47881ebc">shunt_status</a> shunt_get_status </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the shunt process status. </p>
<p>Calling this function resets the shunt idle timeout. So as long as this is called repeatedly, shunt mode will not exit on its own.</p>
<dl class="section return"><dt>Returns</dt><dd>The current status of the shunt process. See shunt_status_t </dd></dl>

</div>
</div>
<a id="ga332dfcb3e6b5bb69971b64c11365dfef" name="ga332dfcb3e6b5bb69971b64c11365dfef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga332dfcb3e6b5bb69971b64c11365dfef">&#9670;&#160;</a></span>shunt_get_pwm()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t shunt_get_pwm </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the PWM setting. </p>
<p>Returns the value used for PWM setting. The range is 0-255, where 255 represents 100% duty cycle.</p>
<dl class="section return"><dt>Returns</dt><dd>The current PWM setting as 8-bit value. </dd></dl>

</div>
</div>
<a id="gafcfc1bc1d30f561b1c5e78965133abc1" name="gafcfc1bc1d30f561b1c5e78965133abc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafcfc1bc1d30f561b1c5e78965133abc1">&#9670;&#160;</a></span>shunt_set()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void shunt_set </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>newpwm</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the PWM level (out of 255). </p>
<p>This is used to set the PWM duty cycle as an 8-bit value (255=&gt;100%).</p>
<dl class="section note"><dt>Note</dt><dd>This is provided as a public API for now, but cant really be used for manual PWM setting at this time. </dd></dl>

</div>
</div>
<a id="ga4a8884dc58e141d827d1de7301d74636" name="ga4a8884dc58e141d827d1de7301d74636"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4a8884dc58e141d827d1de7301d74636">&#9670;&#160;</a></span>shunt_run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#gabe10e4834cb594ddeea4baec47881ebc">shunt_status</a> shunt_run </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Run shunt mode monitoring process. </p>
<p><b>This function MUST be called periodically while shunting is turned on.</b> If this function is not called periodically, the cell boards could overheat and cause damage to the boards and possibly the cells. It will monitor various conditions such as cell voltage and temperature to help prevent overheating or over draining the cells.</p>
<p>The shunt load resistor is regulated using PWM. The duty cycle is increased as the voltage rises above the configurable lower voltage limit. It will be 100% when the voltage reaches the upper limit.</p>
<p>Temperature is also measured and used to limit the maximum allowable PWM duty cycle. As the temperature rises above the lower limit, the PWM will be limited, starting at 100% and droppping to 0% if the temperature reaches the maximum limit.</p>
<p>While in shunt mode, the BMSNode board does not use any power saving mode and thus will eventually drain the cell faster that when in non-shunting mode.</p>
<p>While in shunt mode, <a class="el" href="#gab1f05b356328e9852ec84316041974db" title="Get the shunt process status.">shunt_get_status()</a> must be called at least every 30 seconds, or shunt mode will timeout and turn off.</p>
<dl class="section return"><dt>Returns</dt><dd>the current status of the shunt process. This is the same value returned from <a class="el" href="#gab1f05b356328e9852ec84316041974db" title="Get the shunt process status.">shunt_get_status()</a>. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="footer">
					Generated on Wed Jan 22 2025 15:43:06 for BMSNode by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"
                     onerror="this.onerror=null;this.src='doxygen.svg';"/></a> 1.11.0.
					Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>
