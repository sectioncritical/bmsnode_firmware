#
# for images, assumes that the following are installed:
#     node module "state-machine-cat" (smcat)
#     program "ditaa" (http://ditaa.sourceforge.net/)
#
# for generating docs, assumes doxygen is intalled
#
# The "all" target only rebuilds the doxygen docs and not the images.
# My expectation is that the images are generated by developer and committed
# to the repo. This way they will be present for view/browsing within
# browser of repo on gitlab, etc. Also it simplifies tools needed for CI
# build if the images are just already built and in the repo already.
#
# If the source for an image is changed, the the `make images` target should
# be run and resulting changed files committed.
#

IMG_DIR=../img

MDFILES=../README.md license.md ../packet.md ../command.md ../blink-patterns.md

DIAGRAMS=$(IMG_DIR)/system-diagram.png $(IMG_DIR)/state-diagram.svg

all: docs

docs: html/index.html html/img

images: $(DIAGRAMS)

html/img:
	cp -r ../img/ html/img/

html/index.html: $(MDFILES)
	rm -rf html
	doxygen

.PHONY: clean
clean:
	rm -rf html

.PHONY: cleanimg
cleanimg:
	rm -f $(DIAGRAMS)

%.png: %.ditaa
	ditaa $< -S -o

%.svg: %.smcat
	smcat $<

.PHONY: serve
serve:
	cd html; python3 -m http.server
